(self.webpackChunkethereum_wallet=self.webpackChunkethereum_wallet||[]).push([[179],{65836:function(e,t,n){"use strict";var r=n(15861),a=(n(66992),n(33948),n(60285),n(54678),n(74916),n(64765),n(91058),n(39714),n(2707),n(88674),n(8975)),o=n(44431),l=n(3283),s=n.n(l),u=n(65616),i=n.n(u),c=(n(67294),n(73935),n(96487)),d=(n(718),n(62860)),m=n(34424),h=Object.keys||n(82215),w=n(92359);n(74620);var f=n(42152);(0,c.A)({});function _(e){console.info("Action:",e.action),console.info("Text:",e.text),console.info("Trigger:",e.trigger),alert(window.ethereumWallet.str_copied_msg),e.clearSelection()}function g(){if(void 0!==window.ethereumWallet&&!0!==window.ethereumWallet.initialized){if(void 0!==window.ethereumWallet.web3Endpoint){var e=new window.URL(window.ethereumWallet.web3Endpoint),t={withCredentials:!1},n=e.username+":"+e.password,{web3Endpoint:r}=window.ethereumWallet;":"!==n&&(t.headers=[{name:"authorization",value:"Basic "+(btoa?btoa(n):n)}],r=e.origin),window.ethereumWallet.web3=new(s())(new(s().providers.HttpProvider)(r,t)),window.ethereumWallet.web3.eth.defaultAccount="0x0000000000000000000000000000000000000000"}window.ethereumWallet.copytoclipboardbuttons=[];for(var o=1;o<100;o++){if(jQuery(".pacmec-wallet-account-canvas-qr"+o).length>0){jQuery(".pacmec-wallet-account-canvas-qr"+o).qrcode({text:jQuery("#pacmec-wallet-account"+o).val()});var l=new f("#pacmec-wallet-account-copy-qr-button"+o);l.on("success",_),window.ethereumWallet.copytoclipboardbuttons.push(l)}if(jQuery(".pacmec-wallet-account-management-export-canvas-qr"+o).length>0){jQuery(".pacmec-wallet-account-management-export-canvas-qr"+o).qrcode({text:jQuery("#pacmec-wallet-account-management-export"+o).val()});var u=new f("#pacmec-wallet-account-management-export-copy-qr-button"+o);u.on("success",_),window.ethereumWallet.copytoclipboardbuttons.push(u)}}if(jQuery(".pacmec-wallet-history-table").length>0&&jQuery(".pacmec-wallet-history-table").DataTable({language:{url:window.ethereumWallet.localePath},columns:[{data:"counter"},{data:"value",type:"num",render:function(e,t,n){return"sort"===t?n.dir?parseFloat(e):-parseFloat(e):n.dir?e:'<span class="pacmec-wallet-history-dir pacmec-wallet-history-minus">-</span>'+e}},{data:"timeStamp",render:function(e,t,n){if("sort"===t)return e;if(void 0!==n.unconfirmed&&n.unconfirmed)return window.ethereumWallet.str_tx_pending_msg;var r=(new Date-new Date(1e3*e))/864e5,o="";if(r>=1)o=(0,a.sprintf)(window.ethereumWallet.str_date_days_fmt_msg,Math.floor(r));else{var l=24*r;if(l>=1)o=(0,a.sprintf)(window.ethereumWallet.str_date_hours_fmt_msg,Math.floor(l));else{var s=60*l;o=s>=1?(0,a.sprintf)(window.ethereumWallet.str_date_minutes_fmt_msg,Math.floor(s)):window.ethereumWallet.str_date_recently_msg}}return o}},{data:"hash",render:function(e,t,n){var r=e.substr(0,8);return'<a target="_blank" href="'+(0,a.sprintf)(window.ethereumWallet.txHashPathTemplate,e)+'">'+r+"</a>"}}]}),jQuery(".pacmec-wallet-accounts-table").length>0){var c=jQuery("table.pacmec-wallet-accounts-table > thead > tr").children().length,d=jQuery("table.pacmec-wallet-accounts-table").data("wpnonce"),m=jQuery(".pacmec-wallet-accounts-table-shortcode").find(".pacmec-wallet-accounts-table-token-address").text(),h=jQuery(".pacmec-wallet-accounts-table-shortcode").find(".pacmec-wallet-accounts-table-min-token-amount").text(),g=[];g.push({data:"rank",orderable:!1,type:"num"}),6===c&&(g.push({data:"avatarUrl",orderable:!1,render:function(e,t,n){return'<img class="pacmec-wallet-accounts-table-avatar-img" src="'+e+'">'}}),g.push({data:"username",orderable:!1})),g.push({data:"ether_address",orderable:!1,render:function(e,t,n){var r=e.substr(0,8);return'<a target="_blank" href="'+(0,a.sprintf)(window.ethereumWallet.addressPathTemplate,e)+'" title="'+r+'">'+r+"</a>"}}),g.push({data:"fiat_balance",orderable:!1}),g.push({data:"tx_count",orderable:!1}),jQuery(".pacmec-wallet-accounts-table").DataTable({language:{url:window.ethereumWallet.localePath},order:[],processing:!0,serverSide:!0,ajax:{url:window.ethereumWallet.site_url+"/wp-json/ethereumwallet/v1/accounts",type:"POST",data:function(e){e._wpnonce=d,e.page=Math.floor(e.start/e.length)+1,e.per_page=e.length,e.s=e.search.value,e.token_address=m,e.min_token_amount=h}},columns:g})}var y;y=()=>{window.ethereumWallet.initialized=!0},v(null,(function(e,t){if(e)return Q(),void console.log(e);var n=window.ethereumWallet.user_wallet_last_txhash;if(""!==n){var r=1,a=300,o=window.ethereumWallet.user_wallet_last_txtime,l=1e3*a;""!==o&&(l=1e3*parseInt(o));var s=new Date,u=new Date(s.getTime()-l);s-u<1e3*a&&(jQuery("#pacmec-wallet-tx-in-progress-spinner").addClass("is-active"),""!==window.ethereumWallet.user_wallet_last_txhash&&(jQuery("#pacmec-wallet-tx-in-progress-alert").removeClass("hidden"),jQuery("#pacmec-wallet-tx-in-progress-alert").removeAttr("hidden")),function(e,t,n,r,a){var o,l=window.ethereumWallet.web3,s=Number.MAX_SAFE_INTEGER,u={start:1,mined:2,awaited:3,confirmed:4,unconfirmed:5},i=new Date((new Date).getTime()-r),c=(u.start,function(){return!(new Date-i>1e3*n&&(u.unconfirmed,a(new Error("Timed out, not confirmed"),null),1))}),d=function t(){c()&&l.eth.getTransaction(e,(function(e,n){if(e||null===n)return console.log(e),void setTimeout(t,1e3);null!==n.blockHash?(s=n.blockNumber,o=n,console.log("mined"),u.mined,setTimeout(m,1)):setTimeout(t,1e3)}))},m=function e(){c()&&l.eth.getBlockNumber((function(n,r){if(n)return console.log(n),void setTimeout(e,1e3);console.log("blockNum: ",r),r>=t+s?(u.awaited,setTimeout(h,1)):(console.log("Need to wait ",t+s-r," blocks"),setTimeout(e,1e3))}))},h=function t(){c()&&l.eth.getTransactionReceipt(e,(function(e,n){if(e||null===n)return e&&console.log("getTransactionReceipt: ",e),void setTimeout(t,1e3);console.log("receipt: ",n),void 0!==n.status?"0x1"===n.status||!0===n.status?(u.confirmed,a(null,n)):"0x0"===n.status?n.gasUsed>o.gas?(u.unconfirmed,a(new Error("we ran out of gas, not confirmed!"),null)):(u.unconfirmed,a(new Error("bad tx status, not confirmed!"),null)):n.gasUsed>=o.gas?(u.unconfirmed,a(new Error("we ran out of gas, not confirmed!"),null)):(u.confirmed,a(null,n)):n.gasUsed>=o.gas?(u.unconfirmed,a(new Error("we ran out of gas, not confirmed!"),null)):(u.confirmed,a(null,n))}))};d()}(n,r,a,l,(function(e,t){if(e)return Q(),void console.log(e);function r(){v(n,(function(e,t){if(e)return Q(),void console.log(e);t?Q():setTimeout(r,5e3)}))}setTimeout(r,3e4),p()})))}y.call(null,null,null)})),setInterval(p,1e4),function(){if(0===jQuery(".pacmec-wallet-sendform-shortcode").length)return;var e=null,t=document.getElementById("pacmec-wallet-to-canvas-qr1"),n=t.getContext("2d"),r=250,a="#FF3B58";function o(e,t,r){n.beginPath(),n.moveTo(e.x,e.y),n.lineTo(t.x,t.y),n.lineWidth=4,n.strokeStyle=r,n.stroke()}function l(){if(e){if(e.readyState===e.HAVE_ENOUGH_DATA){t.hidden=!1,n.drawImage(e,0,0,t.width,t.height);var s=n.getImageData(0,0,t.width,t.height),u=i()(s.data,s.width,s.height,{inversionAttempts:"dontInvert"});if(u){o(u.location.topLeftCorner,u.location.topRightCorner,a),o(u.location.topRightCorner,u.location.bottomRightCorner,a),o(u.location.bottomRightCorner,u.location.bottomLeftCorner,a),o(u.location.bottomLeftCorner,u.location.topLeftCorner,a),console.log(u.data);var{data:c}=u,d="ethereum:";w(c,d)&&(c=c.substring(d.length,c.length)),jQuery("#pacmec-wallet-sendform-to").val(c)}}setTimeout((function(){requestAnimationFrame(l)}),r)}}jQuery("#pacmec-wallet-to-qr1").on("shown.bs.collapse",(function(){navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then((function(t){jQuery("#pacmec-wallet-to-canvas-qr1-loading-message").addClass("d-none"),e||(e=document.createElement("video")).setAttribute("playsinline",!0),e.srcObject=t,e.onloadedmetadata=function(t){e.play()},setTimeout((function(){requestAnimationFrame(l)}),r)})).catch((function(e){console.error(e.name+": "+e.message),alert(e.name+": "+e.message),jQuery("#pacmec-wallet-to-canvas-qr1-loading-message").removeClass("d-none")}))})),jQuery("#pacmec-wallet-to-qr1").on("hidden.bs.collapse",(function(){e&&e.srcObject.getTracks().forEach((function(e){e.stop()}))}))}(),jQuery("form[name=pacmec-wallet-send-form]").submit((function(){var e=this;return T((function(t,n){t?console.log(t):n?function(e,t){var n=jQuery("<form></form>");n.attr("method","post"),n.attr("action",t),jQuery(e).find("input, select").each((function(e){var t=jQuery(this),r=t.clone();r.val(t.val()),r.appendTo(n)})),jQuery(document.body).append(n),n.submit()}(e,jQuery(e).attr("action")):console.log("validation failed")})),!1}))}}function p(){jQuery(".pacmec-wallet-balance-shortcode").each((function(){var e,t,n=jQuery(this),r=n.find(".pacmec-wallet-balance-token-address"),l=n.find(".pacmec-wallet-balance-token-decimals"),s=n.find(".pacmec-wallet-balance-token-decimal-char"),u=n.find(".pacmec-wallet-balance-token-symbol"),i=n.find(".pacmec-wallet-balance-value"),c=r.text(),h=u.text(),w=parseInt(l.text()),f=s.text();""===c?(e=window.ethereumWallet.user_wallet_address,t=function(e,t){if(e)console.log(e);else{var n=function(e,t,n,r){var l="",s="";void 0===r&&(r=18);var u=new o.BigNumber(10).pow(r),i=e.idiv(u),c=e.minus(i.times(u));if(0===t)c.times(new o.BigNumber(2)).comparedTo(u)<0?(l=i.toString(),s=i.toString()):(l=i.add(new o.BigNumber(1)).toString(),s=i.add(new o.BigNumber(1)).toString());else{var h=c.toString(),w=(0,a.sprintf)("%0"+r+"s",h),f=w.substr(0,t);d("",t,"0")===f?(l=m(i.toString()+n+w,"0"),s=m(i.toString()+"."+w,"0")):(l=m(i.toString()+n+f,"0"),s=m(i.toString()+"."+f,"0")),l=m(l,n),s=m(s,".")}return l}(new o.BigNumber(t),w,f);i.text()!==n&&(setTimeout((function(){v(null,(function(e,t){e&&console.log(e)}))}),3e4),""===h?i.html(n):i.html(n+" "+h))}},window.ethereumWallet.web3.eth.getBalance(e,(function(e,n){e?t.call(null,e,null):t.call(null,null,n)}))):"function"==typeof PACMEC_WALLET_update_token_balances&&PACMEC_WALLET_update_token_balances()}))}function v(e,t){if(0!==jQuery(".pacmec-wallet-history-table").length){var{user_wallet_address:n}=window.ethereumWallet,a=function(){var a=(0,r.Z)((function*(){try{var a=yield function(e){return x.apply(this,arguments)}(n),o=y(a,n),l=yield function(e){return W.apply(this,arguments)}(n),s=y(l,n),u="function"==typeof PACMEC_WALLET_load_tokens_transactions?yield PACMEC_WALLET_load_tokens_transactions(n):[],i="function"==typeof PACMEC_WALLET_prepare_tokens_transactions?yield PACMEC_WALLET_prepare_tokens_transactions(u,n):[],c="function"==typeof PACMEC_WALLET_load_nft_tokens_transactions?yield PACMEC_WALLET_load_nft_tokens_transactions(n):[],d="function"==typeof PACMEC_WALLET_prepare_nft_tokens_transactions?yield PACMEC_WALLET_prepare_nft_tokens_transactions(c,n):[],m=yield function(){return E.apply(this,arguments)}(),w=m.concat(o).concat(s).concat(d);console.log({tokens_transactions:u,tokens_transactions_result:i,nft_tokens_transactions:c,nft_tokens_transactions_result:d,unconfirmed_transactions_result:m,result:w}),jQuery(".pacmec-wallet-history-table").each((0,r.Z)((function*(){var n=jQuery(this),r=n.data("dividendscontractaddress");r=void 0===r?"":r.toLowerCase();var o=i;if("function"==typeof PACMEC_WALLET_prepare_tokens_transactions){var l=a.filter((function(e){return""!==r&&r===e.to})),s={};l.forEach((function(e){s[e.hash]=e})),""!==r&&(o=i.filter((e=>void 0!==s[e.hash]&&e.dir)))}var u=o;""===r&&(u=w.concat(o)),console.log({tokens_transactions_result_div:o,local_result:u});var c={};u.forEach((function(e){c[e.hash]=e}));var d=void 0!==c[e];(u=h(c).map((function(e){return c[e]}))).sort((function(e,t){return t.timeStamp-e.timeStamp})),u.forEach((function(e,t){e.counter=t+1})),console.log({updated:d,local_result:u}),function(e,t){var n=t.hasClass("pacmec-wallet-history-table-direction-in"),r=t.hasClass("pacmec-wallet-history-table-direction-out"),a=t.DataTable();a.clear(),a.rows.add(e.filter((function(e){return(!e.dir||!r)&&!(!e.dir&&n)}))),a.draw(!1)}(u,n),t.call(null,null,d)})))}catch(e){console.log("PACMEC_WALLET_update_transactions:",e)}}));return function(){return a.apply(this,arguments)}}();a()}else setTimeout((function(){t.call(null,null,!0)}),0)}function y(e,t){for(var n=[],r=0;r<e.length;r++){var a=e[r];if("0"!==a.value){var o=parseFloat(a.value)/1e18;n.push({value:o+" ETH",timeStamp:parseInt(a.timeStamp),hash:a.hash,dir:t.toLowerCase()===a.to.toLowerCase(),from:a.from.toLowerCase(),to:a.to.toLowerCase()})}}return n}function E(){return(E=(0,r.Z)((function*(){var e=window.ethereumWallet.user_wallet_last_txhash;if(""===e)return[];var t=window.ethereumWallet.user_wallet_last_txtime;if(""===t)return[];var n=1e3*parseInt(t),r=new Date,a=new Date(r.getTime()-n),o=window.ethereumWallet.user_wallet_last_tx_value;return"0x0000000000000000000000000000000000000001"!==window.ethereumWallet.user_wallet_last_tx_currency?"function"==typeof PACMEC_WALLET_get_unconfirmed_token_transactions?yield PACMEC_WALLET_get_unconfirmed_token_transactions():[]:[{value:o+" ETH",timeStamp:parseInt(""+Math.floor(a.getTime()/1e3)),dir:!1,hash:e,unconfirmed:!0}]}))).apply(this,arguments)}function T(e){var t=jQuery("#pacmec-wallet-sendform-to").val();if(""!==t){var n=jQuery("#pacmec-wallet-sendform-amount").val();if(""!==n){var r=jQuery("#pacmec-wallet-sendform-currency").val();"0x0000000000000000000000000000000000000001"!==r&&(n="0");var a=new o.BigNumber(n).times(new o.BigNumber(10).pow(18)),l=new o.BigNumber(21e3).times(new o.BigNumber(window.ethereumWallet.gasPrice));window.ethereumWallet.web3.eth.getBalance(window.ethereumWallet.user_wallet_address,(function(s,u){return s?(console.log(s),void e.call(null,null,!1)):new o.BigNumber(u).minus(a).lt(l)?(alert(window.ethereumWallet.str_insufficient_eth_balance_msg),void e.call(null,null,!1)):void("0x0000000000000000000000000000000000000001"!==r&&"undefined"!=typeof PACMEC_WALLET_get_messageForTransferRestriction?PACMEC_WALLET_get_messageForTransferRestriction(r,window.ethereumWallet.user_wallet_address,t,n,(function(t,n){if(t)return console.log(t),void e.call(null,null,!1);if(null!==n)return window.ethereumWallet.error_message=n,L(),console.log("restrictionMsg:",n),void e.call(null,null,!1);var r=window.ethereumWallet.user_wallet_last_txhash;""!==r?window.ethereumWallet.web3.eth.getTransaction(r,(function(t,n){if(t||null===n)return console.log(t),window.ethereumWallet.error_message=t,L(),void e.call(null,null,!1);null!==n.blockHash?e.call(null,null,!0):(console.log(window.ethereumWallet.str_prev_tx_pending_msg),window.ethereumWallet.error_message=window.ethereumWallet.str_prev_tx_pending_msg,L(),e.call(null,null,!1))})):e.call(null,null,!0)})):e.call(null,null,!0))}))}else e.call(null,null,!1)}else e.call(null,null,!1)}jQuery(document).ready(g),jQuery(document).ajaxComplete((function(e,t,n){!t||void 0===t.responseText||-1===t.responseText.indexOf("pacmec-wallet-account-shortcode")&&-1===t.responseText.indexOf("pacmec-wallet-sendform-shortcode")&&-1===t.responseText.indexOf("pacmec-wallet-account-management-create-shortcode")&&-1===t.responseText.indexOf("pacmec-wallet-account-management-select-shortcode")&&-1===t.responseText.indexOf("pacmec-wallet-account-management-import-shortcode")&&-1===t.responseText.indexOf("pacmec-wallet-account-management-export-shortcode")&&-1===t.responseText.indexOf("pacmec-wallet-balance-shortcode")&&-1===t.responseText.indexOf("pacmec-wallet-dividends-shortcode")&&-1===t.responseText.indexOf("pacmec-wallet-tokens-list-shortcode")&&-1===t.responseText.indexOf("pacmec-wallet-history-shortcode")||g()})),window.ethereumWallet.validate_send_form=T,window.ethereumWallet.validate_account_management_create_form=function(){if(""===jQuery("#pacmec-wallet-account-management-create-name").val())return!1},window.ethereumWallet.validate_account_management_import_form=function(){return""!==jQuery("#pacmec-wallet-account-management-import-name").val()&&(""!==jQuery("#pacmec-wallet-account-management-import-key").val()&&void 0)},window.ethereumWallet.validate_account_management_select_form=function(){};var b=[];function x(){return(x=(0,r.Z)((function*(e){return new Promise(((t,n)=>{if(""!==e){var r=null;jQuery.hasOwnProperty("ajaxSettings")&&jQuery.ajaxSettings.hasOwnProperty("headers")&&jQuery.ajaxSettings.headers.hasOwnProperty("X-CSRF-UMP-TOKEN")&&(r=jQuery.ajaxSettings.headers["X-CSRF-UMP-TOKEN"],delete jQuery.ajaxSettings.headers["X-CSRF-UMP-TOKEN"]);var o=(0,a.sprintf)(window.ethereumWallet.txListAPIURLTemplate,e);jQuery.ajax({headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"},url:o,success:function(e){if(jQuery.hasOwnProperty("ajaxSettings")&&jQuery.ajaxSettings.hasOwnProperty("headers")&&null!==r&&(jQuery.ajaxSettings.headers["X-CSRF-UMP-TOKEN"]=r),"1"!==e.status)return console.log("PACMEC_WALLET_load_transactions:",e.message,o),void t(b);var n=e.result;n.length>=b.length&&(b=n),t(n)},error:function(e,t,r){console.log(e.responseText,{status:t,error:r}),n(new Error(e.responseText))}})}else n(new Error("Empty address requested for PACMEC_WALLET_load_transactions!"))}))}))).apply(this,arguments)}var j=[];function W(){return(W=(0,r.Z)((function*(e){return new Promise(((t,n)=>{if(""!==e){var r=null;jQuery.hasOwnProperty("ajaxSettings")&&jQuery.ajaxSettings.hasOwnProperty("headers")&&jQuery.ajaxSettings.headers.hasOwnProperty("X-CSRF-UMP-TOKEN")&&(r=jQuery.ajaxSettings.headers["X-CSRF-UMP-TOKEN"],delete jQuery.ajaxSettings.headers["X-CSRF-UMP-TOKEN"]);var o=(0,a.sprintf)(window.ethereumWallet.internalTxListAPIURLTemplate,e);jQuery.ajax({headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"},url:o,success:function(e){if(jQuery.hasOwnProperty("ajaxSettings")&&jQuery.ajaxSettings.hasOwnProperty("headers")&&null!==r&&(jQuery.ajaxSettings.headers["X-CSRF-UMP-TOKEN"]=r),"1"!==e.status)return console.log("PACMEC_WALLET_load_internal_transactions:",e.message,o),void t(j);var n=e.result;n.length>=j.length&&(j=n),t(n)},error:function(e,t,r){console.log(e.responseText,{status:t,error:r}),n(new Error(e.responseText))}})}else n(new Error("Empty address requested for PACMEC_WALLET_load_internal_transactions!"))}))}))).apply(this,arguments)}function Q(){jQuery("#pacmec-wallet-tx-in-progress-spinner").removeClass("is-active"),jQuery("#pacmec-wallet-tx-in-progress-alert").addClass("hidden"),jQuery("#pacmec-wallet-tx-in-progress-alert").attr("hidden"," hidden")}function L(){void 0!==window.ethereumWallet.error_message&&""!==window.ethereumWallet.error_message?(jQuery("#pacmec-wallet-error-box").removeClass("hidden"),jQuery("#pacmec-wallet-error-box").removeAttr("hidden"),jQuery("#pacmec-wallet-error-box").find(".pacmec-wallet-error-message").text(window.ethereumWallet.error_message)):(jQuery("#pacmec-wallet-error-box").addClass("hidden"),jQuery("#pacmec-wallet-error-box").attr("hidden"," hidden"),jQuery("#pacmec-wallet-error-box").find(".pacmec-wallet-error-message").text(""))}window.ethereumWallet.PACMEC_WALLET_update_error_message=L},46601:function(){},71922:function(){},2363:function(){},27790:function(){},52361:function(){},94616:function(){}},function(e){e.O(0,[216],(function(){return t=65836,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=main.852e510e181a4404f1c5.js.map